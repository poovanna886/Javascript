<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Storm Prediction Map</title>
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <style>
      #map {
        width: 100%;
        height: 600px;
      }
      .modal {
        transition: opacity 0.5s;
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <!-- Modal -->
    <div
      id="modal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden"
    >
      <div
        class="modal-container p-4 mx-auto max-w-md mt-20 bg-white rounded shadow-lg"
      >
        <h2 class="text-2xl mb-2">Enter City</h2>
        <input
          id="city-input"
          type="text"
          placeholder="City name"
          class="w-full p-2 pl-10 text-sm text-gray-700"
        />
        <button
          onclick="initMap()"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
        >
          Show Map
        </button>
      </div>
    </div>

    <div class="container mx-auto p-4 pt-6 md:p-6 hidden" id="map-container">
      <h1 class="text-3xl mb-2">
        Storm Prediction for <span id="city-name"></span>
      </h1>
      <div id="map" class="shadow-md rounded"></div>
      <input
        id="day-slider"
        type="range"
        min="1"
        max="7"
        value="1"
        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-4"
      />
      <p class="text-lg mt-2">Day: <span id="selected-day">1</span></p>
    </div>

    <script>
      document.getElementById('modal').classList.remove('hidden');

      function initMap() {
        const cityName = document.getElementById('city-input').value;
        document.getElementById('city-name').innerText = cityName;
        document.getElementById('modal').classList.add('hidden');
        document.getElementById('map-container').classList.remove('hidden');
        fetch('data.json')
          .then((response) => response.json())
          .then((data) => {
            const map = L.map('map').setView([37.8, -96], 4);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              attribution:
                '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
              subdomains: ['a', 'b', 'c'],
            }).addTo(map);

            let currentDay = 1;
            let heatLayer;
            function updateHeatMap(day) {
              if (heatLayer) map.removeLayer(heatLayer);
              const dayData = data.days[day - 1].map((point) => [
                point[0],
                point[1],
                point[2],
              ]);
              heatLayer = L.heatLayer(dayData, {
                radius: 25,
                blur: 15,
                maxZoom: 1,
                gradient: { 0.4: 'blue', 0.65: 'yellow', 1: 'red' },
              }).addTo(map);
              heatLayer._animateZoom = function () {}; // Optional: to prevent animation on zoom
            }

            document
              .getElementById('day-slider')
              .addEventListener('input', function (e) {
                currentDay = e.target.value;
                document.getElementById('selected-day').innerText = currentDay;
                updateHeatMap(currentDay);
              });

            updateHeatMap(currentDay);
          });
      }
    </script>
  </body>
</html>
