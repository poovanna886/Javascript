<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productivity Timer</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .full-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: #f0f0f0;
        }
        #timer {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 10px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }
        #startButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1em;
        }
        .dashboard {
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="full-screen">
        <div id="timer"></div>
        <button id="startButton">Start Focus</button>
    </div>
    <div class="dashboard" style="display: block;">
        <div id="timeline_chart" style="width: 100%; height: 300px;"></div>
        <div id="bar_chart" style="width: 100%; height: 300px;"></div>
    </div>

    <script>
    google.charts.load('current', {'packages':['corechart', 'bar']});
    google.charts.setOnLoadCallback(drawCharts);

    let timeLeft = 25 * 60; // 25 minutes in seconds
    const timerElement = document.getElementById('timer');
    const startButton = document.getElementById('startButton');
    let timerInterval;
    let workSessions = JSON.parse(localStorage.getItem('workSessions')) || Array(7).fill({work: 0, pause: 0});

    function startTimer() {
        if (!timerInterval) {
            timerInterval = setInterval(updateTimer, 1000);
            startButton.textContent = 'Pause';
        } else {
            clearInterval(timerInterval);
            timerInterval = null;
            startButton.textContent = 'Resume';
        }
    }

    function updateTimer() {
        if (timeLeft > 0) {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            updateCircle();
        } else {
            clearInterval(timerInterval);
            timerInterval = null;
            alert('Time is up!');
            playSound();
            startButton.textContent = 'Start Focus';
        }
    }

    function updateCircle() {
        const percent = (timeLeft / (25 * 60)) * 100;
        timerElement.style.background = `conic-gradient(#4CAF50 ${percent}%, #eee ${percent}%)`;
    }

    function playSound() {
        const audio = new Audio('path_to_your_sound_file.mp3'); // Replace with your sound file
        audio.play();
    }

    function drawCharts() {
        drawTimeline();
        drawBarChart();
    }

    function drawTimeline() {
        const data = new google.visualization.DataTable();
        data.addColumn('date', 'Date');
        data.addColumn('number', 'Work');
        data.addColumn('number', 'Pause');

        const today = new Date();
        for (let i = 6; i >= 0; i--) {
            const date = new Date(today);
            date.setDate(today.getDate() - i);
            data.addRow([date, workSessions[i].work, workSessions[i].pause]);
        }

        const options = {
            hAxis: { title: 'Date' },
            vAxis: { title: 'Time' },
            colors: ['blue', 'red']
        };

        const chart = new google.visualization.Timeline(document.getElementById('timeline_chart'));
        chart.draw(data, options);
    }

    function drawBarChart() {
        const data = google.visualization.arrayToDataTable([
            ['Day', 'Hours Worked'],
            ...workSessions.map((session, index) => {
                const day = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][new Date().getDay() - index];
                return [day, session.work / 3600]; // Convert seconds to hours
            }).reverse()
        ]);

        const options = {
            chart: { title: 'Hours Worked Each Day' },
            bars: 'vertical'
        };

        const chart = new google.visualization.BarChart(document.getElementById('bar_chart'));
        chart.draw(data, options);
    }

    startButton.onclick = startTimer;
    window.onscroll = function() { 
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
            document.querySelector('.dashboard').style.display = 'block';
        }
    };
    </script>
</body>
</html>