<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productivity Timer</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .full-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: #f0f0f0;
        }
        #timer {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 10px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }
        #startButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1em;
        }
        .dashboard {
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="full-screen">
        <div id="timer"></div>
        <button id="startButton">Start Focus</button>
    </div>
    <div class="dashboard" style="display: block;">
        <div id="timeline_chart" style="width: 100%; height: 300px;"></div>
        <div id="bar_chart" style="width: 100%; height: 300px;"></div>
    </div>

    <script>
        google.charts.load('current', {'packages':['corechart', 'timeline']});
google.charts.setOnLoadCallback(drawCharts);

let timeLeft = 25 * 60; // 25 minutes in seconds
const timerElement = document.getElementById('timer');
const startButton = document.getElementById('startButton');
let timerInterval;
let isTimerRunning = false;
let workSessions = JSON.parse(localStorage.getItem('workSessions')) || Array(7).fill({work: 0, pause: 0});
let currentSession = {start: null, work: 0, pause: 0};

function startTimer() {
    if (!isTimerRunning) {
        timerInterval = setInterval(updateTimer, 1000);
        startButton.textContent = 'Pause';
        isTimerRunning = true;
        currentSession.start = new Date();
    } else {
        clearInterval(timerInterval);
        timerInterval = null;
        startButton.textContent = 'Resume';
        isTimerRunning = false;
        const pausedDuration = Math.floor((new Date() - currentSession.start) / 1000);
        currentSession.pause += pausedDuration;
    }
}

function updateTimer() {
    if (timeLeft > 0) {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        updateCircle();
    } else {
        clearInterval(timerInterval);
        timerInterval = null;
        isTimerRunning = false;
        alert('Time is up!');
        playSound();
        logSession();
        drawCharts();
        startButton.textContent = 'Start Focus';
        timeLeft = 25 * 60; // Reset the timer
    }
}

function updateCircle() {
    const percent = (timeLeft / (25 * 60)) * 100;
    timerElement.style.background = `conic-gradient(#4CAF50 ${percent}%, #eee ${percent}%)`;
}

function playSound() {
    const audio = new Audio('path_to_your_sound_file.mp3'); // Replace with your sound file
    audio.play();
}

function logSession() {
    const workedDuration = Math.floor((new Date() - currentSession.start) / 1000) - currentSession.pause;
    currentSession.work += workedDuration;
    workSessions.push(currentSession);
    if (workSessions.length > 7) workSessions.shift();
    localStorage.setItem('workSessions', JSON.stringify(workSessions));
    currentSession = {start: null, work: 0, pause: 0};
}

function drawCharts() {
    drawTimeline();
    drawBarChart();
}

function drawTimeline() {
    const container = document.getElementById('timeline_chart');
    const chart = new google.visualization.Timeline(container);
    const dataTable = new google.visualization.DataTable();

    dataTable.addColumn({ type: 'string', id: 'Status' });
    dataTable.addColumn({ type: 'date', id: 'Start' });
    dataTable.addColumn({ type: 'date', id: 'End' });

    const today = new Date();
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const session = workSessions[6 - i];
        if (session.work > 0) {
            dataTable.addRow(['Work', new Date(date.getTime()), new Date(date.getTime() + session.work * 1000)]);
        }
        if (session.pause > 0) {
            dataTable.addRow(['Pause', new Date(date.getTime() + session.work * 1000), new Date(date.getTime() + (session.work + session.pause) * 1000)]);
        }
    }

    const options = {
        hAxis: { title: 'Date' },
        timeline: { showBarLabels: false },
        colors: ['blue', 'red']
    };

    chart.draw(dataTable, options);
}

function drawBarChart() {
    const container = document.getElementById('bar_chart');
    const chart = new google.visualization.ColumnChart(container);
    const data = new google.visualization.DataTable();

    data.addColumn('string', 'Day');
    data.addColumn('number', 'Hours Worked');

    const dailyData = {};
    const today = new Date();
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const day = date.toLocaleDateString('en-US', { weekday: 'short' });
        dailyData[day] = (workSessions[6 - i].work / 3600).toFixed(2); // Convert seconds to hours
    }

    for (const [day, hours] of Object.entries(dailyData)) {
        data.addRow([day, parseFloat(hours)]);
    }

    const options = {
        title: 'Hours Worked Per Day',
        hAxis: { title: 'Day' },
        vAxis: { title: 'Hours Worked' },
        legend: 'none',
        colors: ['#1b9e77']
    };

    chart.draw(data, options);
}

startButton.addEventListener('click', startTimer);

window.addEventListener('scroll', function() {
    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
        document.querySelector('.dashboard').style.display = 'block';
        drawCharts();
    }
});

    </script>
</body>
</html>